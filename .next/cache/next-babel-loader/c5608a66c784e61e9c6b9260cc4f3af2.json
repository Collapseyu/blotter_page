{"ast":null,"code":"var __jsx = React.createElement;\nimport React from 'react';\nimport Link from 'next/link';\nimport { Flex } from '@/components/container';\nimport SVG, { Left, Bar, User } from '@/components/svg';\nimport Button from '@/components/button';\nimport Avatar from '@/components/avatar';\nimport Popover, { Tooltip } from '@/components/popover';\nimport { logout } from '@/utils/api';\nimport ShowNotification from '@/utils/notification';\nimport { setCookie } from '@/utils/storage';\nimport { defaultContext } from '@/utils/global';\nimport styles from './sider.module.scss';\nimport shadowStyles from '@/styles/shadow.module.scss';\nimport { LoginModal } from '../login';\nimport Card from '../card';\nexport default function Sider(props) {\n  const {\n    user,\n    avatar,\n    big_screen,\n    theme: _theme,\n    menus,\n    pathname,\n    callback\n  } = props;\n  const theme = _theme === 'default' ? 'light' : 'dark';\n  const [collapsed, setCollapsed] = React.useState(true);\n  const [loginModal, setLoginModal] = React.useState(false);\n\n  const onLoginClick = () => setLoginModal(true);\n\n  const onLogoutClick = async () => {\n    var r = await logout();\n    ShowNotification(r);\n    setCookie('token', '', 0);\n    callback({\n      user: defaultContext.user\n    });\n  };\n\n  return __jsx(\"div\", null, collapsed ? null : __jsx(\"div\", {\n    className: [styles.dimmed].join(' '),\n    onClick: () => setCollapsed(true)\n  }), __jsx(Flex, {\n    className: [styles.sider, ...(collapsed ? [styles.sider_collapsed] : [])].join(' '),\n    mainAxis: \"flex-start\",\n    subAxis: \"flex-start\"\n  }, __jsx(Flex, {\n    mainAxis: \"flex-start\",\n    direction: \"TB\",\n    wrap: false,\n    className: [shadowStyles.shadow, styles.siderbar].join(' '),\n    style: {\n      width: collapsed ? big_screen ? 80 : 0 : 200,\n      maxWidth: collapsed ? big_screen ? 80 : 0 : 200 // 苹果设备在 width = 0 时会恢复宽度，设置 max-width 来避免该问题\n\n    }\n  }, __jsx(\"div\", null), __jsx(\"img\", {\n    src: avatar,\n    width: \"100%\" // 在 Ubuntu 的 Chrome 上，点击 menu 项时，图片会奇怪地变大。删除 height 参数解决\n    ,\n    style: {\n      background: 'white',\n      borderRadius: '100px',\n      maxWidth: '120px'\n    }\n  }), !user.existed ? __jsx(\"a\", {\n    onClick: onLoginClick\n  }, __jsx(Avatar, null, __jsx(User, null))) : __jsx(Popover, {\n    placement: \"right\",\n    trigger: ['click', 'hover'],\n    card: true,\n    shadow: true,\n    component: __jsx(Card, {\n      style: {\n        background: 'var(--background)',\n        maxWidth: 200\n      }\n    }, __jsx(Flex, {\n      direction: \"TB\",\n      fullWidth: true\n    }, __jsx(\"strong\", null, user.username), __jsx(Flex, null, __jsx(Link, {\n      href: \"/user/[username]\",\n      as: `/user/${user.username}`\n    }, __jsx(\"a\", null, \"\\u8BBE\\u7F6E\")), __jsx(\"a\", {\n      onClick: onLogoutClick\n    }, \"\\u767B\\u51FA\"), (user.permission & 1) != 0 ? __jsx(Link, {\n      href: \"/admin\"\n    }, __jsx(\"a\", null, \"\\u7BA1\\u7406\")) : null)))\n  }, user.avatar ? __jsx(Avatar, {\n    src: user.avatar\n  }) : __jsx(Avatar, null, __jsx(User, null))), __jsx(Flex.Item, {\n    style: {\n      width: '100%'\n    }\n  }, __jsx(Menus, {\n    menus: menus,\n    theme: theme,\n    pathname: pathname\n  }))), __jsx(\"div\", {\n    className: styles.button_wrapper\n  }, __jsx(Button, {\n    primary: true,\n    circle: true,\n    icon: collapsed ? __jsx(Bar, null) : __jsx(Left, null),\n    shadow: true,\n    onClick: () => setCollapsed(!collapsed)\n  }))), __jsx(LoginModal, {\n    show: loginModal,\n    onClose: () => setLoginModal(false)\n  }));\n}\n\nfunction Menus(props) {\n  const {\n    menus,\n    theme,\n    pathname\n  } = props;\n  return __jsx(Flex, {\n    direction: \"TB\",\n    className: styles.menu\n  }, menus.map(item => {\n    const menuItem = __jsx(\"div\", null, __jsx(\"span\", {\n      className: styles.prefix\n    }, item.icon ? __jsx(SVG, {\n      icon: item.icon\n    }) : null), __jsx(\"span\", {\n      className: styles.text\n    }, item.name));\n\n    return __jsx(\"li\", {\n      key: item.link,\n      className: item.link === pathname ? styles.active : ''\n    }, __jsx(Tooltip, {\n      placement: \"right\",\n      title: item.name\n    }, item.link.length > 0 && item.link[0] !== '/' ? __jsx(\"a\", {\n      target: \"_blank\",\n      href: item.link\n    }, menuItem) : __jsx(Link, {\n      href: item.link\n    }, __jsx(\"a\", null, menuItem))));\n  }));\n}","map":null,"metadata":{},"sourceType":"module"}