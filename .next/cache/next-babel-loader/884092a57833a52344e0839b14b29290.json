{"ast":null,"code":"import _regeneratorRuntime from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport Head from 'next/head';\nimport { withRouter } from 'next/router';\nimport { Flex } from '@/components/container';\nimport Button from '@/components/button';\nimport Card from '@/components/card';\nimport Input from '@/components/input';\nimport Avatar from '@/components/avatar';\nimport If from '@/components/if';\nimport { Context } from '@/utils/global';\nimport { info, userSet, avatar } from '@/utils/api';\nimport ShowNotification from '@/utils/notification';\n\nvar User = /*#__PURE__*/function (_React$Component) {\n  _inherits(User, _React$Component);\n\n  var _super = _createSuper(User);\n\n  function User(props) {\n    var _this;\n\n    _classCallCheck(this, User);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"context\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"getData\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var user;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return info(_this.props.router.query.username);\n\n            case 2:\n              user = _context.sent;\n\n              _this.setState({\n                user: user\n              });\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"update\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _this$state$user, username, email, ns_id, ns_name, ac_name, ac_island, qq, avatar, r;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _this.setState({\n                loading: true\n              });\n\n              _this$state$user = _this.state.user, username = _this$state$user.username, email = _this$state$user.email, ns_id = _this$state$user.ns_id, ns_name = _this$state$user.ns_name, ac_name = _this$state$user.ac_name, ac_island = _this$state$user.ac_island, qq = _this$state$user.qq, avatar = _this$state$user.avatar;\n              _context2.next = 4;\n              return userSet(username, email, avatar, ns_id, ns_name, ac_name, ac_island, qq, _this.state.password);\n\n            case 4:\n              r = _context2.sent;\n\n              if (ShowNotification(r)) {\n                _this.props.router.push('/user/[username]', \"/user/\".concat(username));\n\n                _this.context.callback({\n                  user: _this.state.user\n                });\n              }\n\n              _this.setState({\n                loading: false\n              });\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _this.state = {\n      user: _this.props.user,\n      loading: false,\n      loadingAvatar: false,\n      password: ''\n    };\n    return _this;\n  }\n\n  _createClass(User, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getData();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var allFields = [{\n        key: 'avatar',\n        name: '头像',\n        self: true,\n        rewrite: function rewrite(url) {\n          return url.replace('http://', 'https://');\n        }\n      }, {\n        key: 'username',\n        name: '用户名',\n        self: false\n      }, {\n        key: 'email',\n        name: '邮箱',\n        self: false\n      }, {\n        key: 'qq',\n        name: 'QQ 号',\n        self: true\n      }, {\n        key: 'ns_id',\n        name: 'NS ID',\n        self: false,\n        prefix: 'SW',\n        rewrite: function rewrite(value) {\n          return value.replace(/[^0-9\\-]/g, '');\n        }\n      }, {\n        key: 'ns_name',\n        name: 'NS 名称',\n        self: false\n      }, {\n        key: 'ac_name',\n        name: '动森名称',\n        self: false\n      }, {\n        key: 'ac_island',\n        name: '动森岛名',\n        self: false,\n        suffix: '岛',\n        rewrite: function rewrite(value) {\n          if (value.length > 0 && value[value.length - 1] == '岛') {\n            value = value.slice(0, value.length - 1);\n          }\n\n          return value;\n        }\n      }];\n      var fields = this.state.user.self ? allFields : allFields.filter(function (item) {\n        return !item.self;\n      });\n      return /*#__PURE__*/_jsxs(Card, {\n        neumorphism: true,\n        children: [/*#__PURE__*/_jsx(Context.Consumer, {\n          children: function children(context) {\n            return /*#__PURE__*/_jsx(Head, {\n              children: /*#__PURE__*/_jsx(\"title\", {\n                children: \"\".concat(_this2.props.router.query.username, \"|\\u7528\\u6237\\u9875|\").concat(context.blog_name)\n              })\n            });\n          }\n        }), /*#__PURE__*/_jsxs(Flex, {\n          direction: \"TB\",\n          fullWidth: true,\n          children: [/*#__PURE__*/_jsx(Avatar, {\n            style: {\n              fontSize: 128,\n              margin: 'auto'\n            },\n            src: this.state.user.avatar\n          }), /*#__PURE__*/_jsx(If, {\n            condition: this.state.user.self,\n            children: /*#__PURE__*/_jsxs(Flex, {\n              children: [/*#__PURE__*/_jsx(Button, {\n                neumorphism: true,\n                loading: this.state.loadingAvatar,\n                onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n                  var r;\n                  return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                    while (1) {\n                      switch (_context3.prev = _context3.next) {\n                        case 0:\n                          _this2.setState({\n                            loadingAvatar: true\n                          });\n\n                          _context3.next = 3;\n                          return avatar(_this2.state.user.email);\n\n                        case 3:\n                          r = _context3.sent;\n\n                          _this2.setState(function (state) {\n                            var user = state.user;\n                            user.avatar = r.avatar;\n                            return {\n                              user: user,\n                              loadingAvatar: false\n                            };\n                          });\n\n                        case 5:\n                        case \"end\":\n                          return _context3.stop();\n                      }\n                    }\n                  }, _callee3);\n                })),\n                children: \"\\u6839\\u636E\\u90AE\\u7BB1\\u66F4\\u65B0 Github\\u3001Gavatar \\u5934\\u50CF\"\n              }), /*#__PURE__*/_jsx(\"a\", {\n                href: \"/api/user/qq_avatar\",\n                target: \"_blank\",\n                children: /*#__PURE__*/_jsx(Button, {\n                  neumorphism: true,\n                  disabled: !this.state.user.qq_connected,\n                  children: \"\\u66F4\\u65B0 QQ \\u5934\\u50CF\"\n                })\n              }), /*#__PURE__*/_jsx(Button, {\n                neumorphism: true,\n                onClick: function onClick() {\n                  return _this2.getData();\n                },\n                children: \"\\u5237\\u65B0\\u6570\\u636E\"\n              })]\n            })\n          }), /*#__PURE__*/_jsx(Flex, {\n            direction: \"TB\",\n            fullWidth: true,\n            children: fields.map(function (item) {\n              return _this2.state.user.self ? /*#__PURE__*/_jsx(Input, {\n                label: item.name,\n                prefix: item.prefix,\n                suffix: item.suffix,\n                value: _this2.state.user[item.key],\n                onChange: function onChange(value) {\n                  if (!!item.rewrite) value = item.rewrite(value);\n\n                  _this2.setState(function (state) {\n                    var user = state.user;\n                    user[item.key] = value;\n                    return {\n                      user: user\n                    };\n                  });\n                }\n              }, item.key) : /*#__PURE__*/_jsxs(\"p\", {\n                children: [item.prefix, \" \", _this2.state.user[item.key], \" \", item.suffix]\n              });\n            })\n          }), /*#__PURE__*/_jsx(If, {\n            condition: this.state.user.self,\n            children: /*#__PURE__*/_jsxs(Flex, {\n              children: [/*#__PURE__*/_jsx(Input, {\n                type: \"password\",\n                placeholder: \"\\u5982\\u679C\\u4E0D\\u9700\\u8981\\u4FEE\\u6539\\u5BC6\\u7801\\u8BF7\\u7559\\u7A7A\",\n                value: this.state.password,\n                onChange: function onChange(value) {\n                  return _this2.setState({\n                    password: value\n                  });\n                }\n              }), !this.state.user.qq_connected ? /*#__PURE__*/_jsx(\"a\", {\n                href: \"/api/user/jump_to_qq?state=connect\",\n                target: \"_blank\",\n                children: /*#__PURE__*/_jsx(Button, {\n                  neumorphism: true,\n                  children: \"\\u7ED1\\u5B9A QQ \\u767B\\u5F55\"\n                })\n              }) : /*#__PURE__*/_jsx(Button, {\n                neumorphism: true,\n                disabled: true,\n                children: \"\\u5DF2\\u7ED1\\u5B9A QQ \\u767B\\u5F55\"\n              }), !this.state.user.github_connected ? /*#__PURE__*/_jsx(\"a\", {\n                href: \"/api/user/jump_to_github?state=connect\",\n                target: \"_blank\",\n                children: /*#__PURE__*/_jsx(Button, {\n                  neumorphism: true,\n                  children: \"\\u7ED1\\u5B9A Github \\u767B\\u5F55\"\n                })\n              }) : /*#__PURE__*/_jsx(Button, {\n                neumorphism: true,\n                disabled: true,\n                children: \"\\u5DF2\\u7ED1\\u5B9A Github \\u767B\\u5F55\"\n              }), /*#__PURE__*/_jsx(Button, {\n                neumorphism: true,\n                loading: this.state.loading,\n                primary: true,\n                onClick: this.update,\n                children: \"\\u66F4\\u65B0\\u4FE1\\u606F\"\n              })]\n            })\n          })]\n        })]\n      });\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(args) {\n        var user;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return info(args.query.username);\n\n              case 2:\n                user = _context4.sent;\n                return _context4.abrupt(\"return\", {\n                  user: user\n                });\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return User;\n}(React.Component);\n\n_defineProperty(User, \"defaultProps\", {});\n\n_defineProperty(User, \"contextType\", Context);\n\nexport default withRouter(User);","map":null,"metadata":{},"sourceType":"module"}