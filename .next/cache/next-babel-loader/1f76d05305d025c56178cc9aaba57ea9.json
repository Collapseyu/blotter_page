{"ast":null,"code":"import _regeneratorRuntime from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _assertThisInitialized from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _createClass from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport Router, { withRouter } from 'next/router';\nimport PostList from '@/components/post_list';\nimport { Pre, Next, Dots } from '@/components/svg';\nimport { A } from '@/components/button';\nimport Timeline from '@/components/timeline';\nimport Card from '@/components/card';\nimport { Flex } from '@/components/container';\nimport { archives } from '@/utils/api';\nimport { parseNumberParams } from '@/utils/parse';\nimport { Context } from '@/utils/global';\nimport { formatSecond } from '@/utils/time';\nimport Pagination from '@/components/pagination';\nimport Tag from '@/components/tag';\nimport textStyles from '@/styles/text.module.scss';\nimport { CheckBox } from '@/components/input';\n\nfunction pageRender(current, pageNumber, size, page, onChange, disabled, extend) {\n  switch (page) {\n    case -2:\n      {\n        return /*#__PURE__*/_jsx(Link, {\n          href: \"/archives?card=\".concat(extend ? 1 : 0, \"&page=\").concat(current - 1, \"&size=\").concat(size),\n          passHref: true,\n          children: /*#__PURE__*/_jsx(A, {\n            disabled: disabled || current - 1 < 1,\n            onClick: function onClick() {\n              return onChange(current - 1, size);\n            },\n            icon: /*#__PURE__*/_jsx(Pre, {})\n          })\n        });\n      }\n\n    case -3:\n      {\n        return /*#__PURE__*/_jsx(Link, {\n          href: \"/archives?card=\".concat(extend ? 1 : 0, \"&page=\").concat(current + 1, \"&size=\").concat(size),\n          passHref: true,\n          children: /*#__PURE__*/_jsx(A, {\n            disabled: disabled || current + 1 > pageNumber,\n            onClick: function onClick() {\n              return onChange(current + 1, size);\n            },\n            icon: /*#__PURE__*/_jsx(Next, {})\n          })\n        });\n      }\n\n    case -1:\n      {\n        return /*#__PURE__*/_jsx(Dots, {});\n      }\n\n    default:\n      {\n        return /*#__PURE__*/_jsx(Link, {\n          href: \"/archives?card=\".concat(extend ? 1 : 0, \"&page=\").concat(page, \"&size=\").concat(size),\n          passHref: true,\n          children: /*#__PURE__*/_jsx(A, {\n            disabled: disabled || current === page,\n            clicked: current === page,\n            onClick: function onClick() {\n              return onChange(page, size);\n            },\n            children: page\n          })\n        });\n      }\n  }\n}\n\nvar timelineSize = 20;\n\nvar Archives = /*#__PURE__*/function (_React$Component) {\n  _inherits(Archives, _React$Component);\n\n  var _super = _createSuper(Archives);\n\n  _createClass(Archives, null, [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(args) {\n        var card, page, size, data;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                card = parseNumberParams('card', args.asPath, 0) != 0;\n                page = parseNumberParams('page', args.asPath, 1);\n                size = parseNumberParams('size', args.asPath, card ? 10 : timelineSize);\n                _context.next = 5;\n                return archives(page, size);\n\n              case 5:\n                data = _context.sent;\n                return _context.abrupt(\"return\", {\n                  page: page,\n                  size: size,\n                  posts: data.posts,\n                  total: data.total,\n                  card: card\n                });\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  function Archives(props) {\n    var _this;\n\n    _classCallCheck(this, Archives);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"context\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (page, size) {\n      if (size != _this.props.size) {\n        var newPage = Math.floor((_this.props.page - 1) * _this.props.size / size + 1);\n        Router.push(\"/archives?card=\".concat(_this.props.card ? 1 : 0, \"&page=\").concat(newPage, \"&size=\").concat(size));\n      }\n    });\n\n    _this.state = {\n      loading: false\n    };\n    return _this;\n  }\n\n  _createClass(Archives, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return /*#__PURE__*/_jsxs(\"div\", {\n        children: [/*#__PURE__*/_jsx(Context.Consumer, {\n          children: function children(context) {\n            return /*#__PURE__*/_jsx(Head, {\n              children: /*#__PURE__*/_jsx(\"title\", {\n                children: \"\\u7B2C\".concat(_this2.props.page, \"\\u9875|\\u5F52\\u6863\\u9875|\").concat(context.blog_name)\n              })\n            });\n          }\n        }), /*#__PURE__*/_jsxs(Flex, {\n          direction: \"TB\",\n          fullWidth: true,\n          children: [/*#__PURE__*/_jsx(Card, {\n            neumorphism: true,\n            children: /*#__PURE__*/_jsxs(Flex, {\n              direction: \"LR\",\n              mainAxis: \"flex-start\",\n              children: [/*#__PURE__*/_jsx(CheckBox, {\n                switchStyle: true,\n                checkText: \"\\u5361\\u7247\",\n                uncheckText: \"\\u65F6\\u95F4\\u7EBF\",\n                value: this.props.card,\n                onChange: function onChange(value) {\n                  return Router.push(\"/archives?card=\".concat(value ? 1 : 0, \"&page=\").concat(_this2.props.page, \"&size=\").concat(_this2.props.size));\n                }\n              }), /*#__PURE__*/_jsxs(\"p\", {\n                children: [\"\\u5171 \", this.props.total, \" \\u7BC7\\u6587\\u7AE0\"]\n              })]\n            })\n          }), this.props.card ? /*#__PURE__*/_jsx(PostList // header={`共 ${this.props.total} 篇文章`}\n          , {\n            posts: this.props.posts,\n            page: this.props.page,\n            size: this.props.size,\n            total: this.props.total,\n            loading: this.state.loading,\n            callback: this.onChange,\n            pageRender: pageRender,\n            pageExtend: this.props.card\n          }) : /*#__PURE__*/_jsx(Card, {\n            neumorphism: true,\n            children: /*#__PURE__*/_jsxs(Flex, {\n              direction: \"TB\",\n              fullWidth: true,\n              children: [/*#__PURE__*/_jsx(Timeline, {\n                direction: \"TB\",\n                data: this.props.posts.map(function (p) {\n                  return {\n                    time: formatSecond(p.publish_time),\n                    name: /*#__PURE__*/_jsxs(Flex, {\n                      direction: _this2.context.big_screen ? 'LR' : 'TB',\n                      subAxis: \"flex-start\",\n                      fullWidth: !_this2.context.big_screen,\n                      children: [/*#__PURE__*/_jsx(Link, {\n                        href: \"/post/[url]\",\n                        as: \"/post/\".concat(p.url),\n                        children: /*#__PURE__*/_jsx(\"a\", {\n                          className: textStyles.color,\n                          style: {\n                            fontWeight: 'bolder'\n                          },\n                          children: p.title\n                        })\n                      }), /*#__PURE__*/_jsx(Flex, {\n                        direction: \"LR\",\n                        mainAxis: \"flex-end\",\n                        subSize: \"middle\",\n                        children: p.tags.map(function (tag) {\n                          return /*#__PURE__*/_jsx(Tag, {\n                            tag: tag\n                          });\n                        })\n                      })]\n                    })\n                  };\n                }),\n                style: {\n                  gridTemplateColumns: this.context.big_screen ? '150px 24px 1px auto' : '75px 25px 1px auto'\n                }\n              }), /*#__PURE__*/_jsx(Pagination, {\n                page: this.props.page,\n                size: this.props.size,\n                total: this.props.total,\n                disabled: this.state.loading,\n                onChange: this.onChange,\n                render: pageRender,\n                sizeSelect: [10, 20, 30, 40],\n                extend: this.props.card\n              })]\n            })\n          })]\n        })]\n      });\n    }\n  }]);\n\n  return Archives;\n}(React.Component);\n\n_defineProperty(Archives, \"defaultProps\", {\n  page: 1,\n  total: 1,\n  size: 10,\n  posts: Array(10).fill(undefined)\n});\n\n_defineProperty(Archives, \"contextType\", Context);\n\nexport default withRouter(Archives);","map":null,"metadata":{},"sourceType":"module"}