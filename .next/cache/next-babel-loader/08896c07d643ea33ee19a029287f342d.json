{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport { Triangle, Filter } from '@/components/svg';\nimport Button from '@/components/button';\nimport { CheckBox } from '@/components/input';\nimport { Modal } from '@/components/popover';\nimport { Flex } from '@/components/container';\nimport { Left } from '@/components/svg';\nimport { concat } from '@/utils/component';\nimport styles from './table.less';\nimport Pagination from '../pagination';\nimport Loading from '../loading';\nexport default function Table(props) {\n  var columns = props.columns,\n      data = props.data,\n      style = props.style,\n      _props$showHeader = props.showHeader,\n      showHeader = _props$showHeader === void 0 ? true : _props$showHeader,\n      _props$defaultOrder = props.defaultOrder,\n      defaultOrder = _props$defaultOrder === void 0 ? {\n    sortKey: '',\n    ascending: false\n  } : _props$defaultOrder,\n      _props$pagination = props.pagination,\n      pagination = _props$pagination === void 0 ? false : _props$pagination,\n      _props$loading = props.loading,\n      loading = _props$loading === void 0 ? false : _props$loading,\n      expand = props.expand;\n  if (!!loading) return loading === true ? __jsx(Loading, null) : loading; // 将简写的列拓展为标准的 Column 类型\n\n  var cols = React.useMemo(function () {\n    return columns.map(function (col) {\n      return typeof col === 'string' ? {\n        key: col\n      } : col;\n    });\n  }, [columns]); // 初始化过滤器部分\n  // 每个列的过滤器\n\n  var _React$useState = React.useState({}),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      filters = _React$useState2[0],\n      setFilters = _React$useState2[1]; // 过滤值\n\n\n  var _React$useState3 = React.useState({}),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      filtersValues = _React$useState4[0],\n      setFiltersValues = _React$useState4[1]; // 过滤器弹出框\n\n\n  var _React$useState5 = React.useState(false),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      filterModal = _React$useState6[0],\n      setFilterModal = _React$useState6[1]; // 列表内容操作\n\n\n  var showData = data.concat([]); // 过滤\n\n  Object.keys(filters).map(function (key) {\n    return showData = showData.filter(function (item, idx) {\n      return filters[key](filtersValues[key], item, idx);\n    });\n  }); // 排序\n\n  var _React$useState7 = React.useState(defaultOrder.sortKey),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      sortKey = _React$useState8[0],\n      setSortKey = _React$useState8[1];\n\n  var _React$useState9 = React.useState(defaultOrder.ascending),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      ascending = _React$useState10[0],\n      setAscending = _React$useState10[1];\n\n  var sortCols = cols.filter(function (col) {\n    return col.key === sortKey;\n  });\n  var sorter = sortCols.length > 0 ? sortCols[0].sorter : undefined;\n\n  if (sorter) {\n    showData.sort(sorter);\n    if (!ascending) showData.reverse();\n  } // 分页\n\n\n  var _React$useState11 = React.useState(typeof pagination !== 'boolean' ? pagination.page : 1),\n      _React$useState12 = _slicedToArray(_React$useState11, 2),\n      pageCurrent = _React$useState12[0],\n      setPageCurrent = _React$useState12[1];\n\n  var _React$useState13 = React.useState(typeof pagination !== 'boolean' ? pagination.size : 10),\n      _React$useState14 = _slicedToArray(_React$useState13, 2),\n      pageSize = _React$useState14[0],\n      setPageSize = _React$useState14[1];\n\n  var paginationProps = React.useMemo(function () {\n    return _objectSpread(_objectSpread({}, {\n      page: pageCurrent,\n      size: pageSize,\n      total: showData.length,\n      onChange: function onChange(page, size) {\n        setPageCurrent(page);\n        setPageSize(size);\n      }\n    }), typeof pagination !== 'boolean' ? pagination : {});\n  }, [pagination, pageCurrent, pageSize, showData]);\n\n  if (pagination !== false) {\n    showData = showData.slice((paginationProps.page - 1) * paginationProps.size, paginationProps.page * paginationProps.size);\n  } // 表格扩展\n\n\n  var reducer = function reducer(state, action) {\n    console.log(state, action);\n    if (action === 'init') return {};\n    return _objectSpread(_objectSpread({}, state), {}, _defineProperty({}, action, !state[action]));\n  };\n\n  var _React$useReducer = React.useReducer(reducer, {}),\n      _React$useReducer2 = _slicedToArray(_React$useReducer, 2),\n      expanded = _React$useReducer2[0],\n      setExpanded = _React$useReducer2[1];\n\n  var resetTable = function resetTable() {\n    paginationProps.onChange(1, paginationProps.size);\n    setExpanded('init');\n  };\n\n  return __jsx(\"div\", {\n    className: styles.table,\n    style: style\n  }, __jsx(\"table\", null, showHeader ? __jsx(\"thead\", {\n    style: {\n      visibility: showHeader ? 'visible' : 'hidden'\n    }\n  }, __jsx(\"tr\", null, !!expand ? __jsx(\"td\", null) : null, cols.map(function (col) {\n    return __jsx(\"th\", {\n      key: col.key,\n      style: col.headStyle\n    }, __jsx(\"div\", {\n      className: styles.title\n    }, !col.title ? col.key : typeof col.title === 'function' ? col.title(col.key) : col.title, !!col.sorter ? __jsx(\"span\", {\n      className: styles.sorter\n    }, __jsx(Button, {\n      className: styles.sorter_icon,\n      icon: __jsx(Triangle, null),\n      size: \"small\",\n      style: {\n        color: sortKey === col.key && ascending ? 'var(--primary)' : 'unset'\n      },\n      onClick: function onClick() {\n        setSortKey(sortKey === col.key && ascending ? '' : col.key);\n        setAscending(true);\n        resetTable();\n      }\n    }), __jsx(Button, {\n      className: styles.sorter_icon,\n      icon: __jsx(Triangle, {\n        style: {\n          transform: 'rotate(180deg)'\n        }\n      }),\n      size: \"small\",\n      style: {\n        color: sortKey === col.key && !ascending ? 'var(--primary)' : 'unset'\n      },\n      onClick: function onClick() {\n        setSortKey(sortKey === col.key && !ascending ? '' : col.key);\n        setAscending(false);\n        resetTable();\n      }\n    })) : null, !!col.filter ? __jsx(\"span\", {\n      className: styles.filter\n    }, __jsx(Button, {\n      className: styles.sorter_icon,\n      icon: __jsx(Filter, null),\n      size: \"small\",\n      style: {\n        color: !!filters[col.key] ? 'var(--primary)' : 'unset'\n      },\n      onClick: function onClick() {\n        setFilterModal(col);\n      }\n    })) : null));\n  }))) : null, __jsx(\"tbody\", null, showData.map(function (item, idx) {\n    return [__jsx(\"tr\", {\n      key: idx\n    }, !!expand ? __jsx(\"td\", {\n      onClick: function onClick() {\n        return setExpanded(idx);\n      }\n    }, __jsx(Left, {\n      className: concat(styles.prefix, !expanded[idx] ? styles.close : '')\n    })) : null, cols.map(function (col) {\n      return __jsx(\"td\", {\n        key: col.key,\n        style: _objectSpread(_objectSpread({}, idx === 0 ? {\n          width: col.width,\n          minWidth: col.minWidth,\n          maxWidth: col.maxWidth\n        } : {}), col.style)\n      }, !!col.render ? col.render(item[col.key], item, idx, data) : item[col.key]);\n    })), !!expand && !!expanded[idx] ? __jsx(\"tr\", {\n      key: \"\".concat(idx, \"-expand\")\n    }, __jsx(\"td\", null), __jsx(\"td\", {\n      colspan: cols.length\n    }, expand(item, idx))) : null];\n  })), cols.filter(function (col) {\n    return !!col.footer;\n  }).length > 0 ? __jsx(\"tfoot\", null, __jsx(\"tr\", null, !!expand ? __jsx(\"td\", null) : null, cols.map(function (col) {\n    return __jsx(\"td\", {\n      key: col.key,\n      style: col.footStyle\n    }, !col.footer ? null : typeof col.footer === 'function' ? col.footer(col.key) : col.footer);\n  }))) : null), pagination !== false ? __jsx(Pagination, _extends({}, paginationProps, {\n    style: _objectSpread({\n      margin: 5\n    }, paginationProps.style),\n    onChange: function onChange(page, size) {\n      setExpanded('init');\n      paginationProps.onChange(page, size);\n    }\n  })) : null, __jsx(Modal, {\n    show: filterModal !== false,\n    onClose: function onClose() {\n      return setFilterModal(false);\n    }\n  }, filterModal === false ? null : __jsx(\"div\", null, __jsx(Flex, {\n    direction: \"TB\",\n    fullWidth: true\n  }, __jsx(Flex, {\n    mainAxis: \"flex-start\",\n    subAxis: \"center\",\n    subSize: \"middle\"\n  }, filterModal.filter.filters.map(function (item) {\n    return __jsx(CheckBox, {\n      key: item,\n      value: !!filtersValues[filterModal.key] && filtersValues[filterModal.key].indexOf(item) !== -1,\n      onChange: function onChange(checked) {\n        var array = filtersValues[filterModal.key];\n        if (!array) array = [];\n\n        if (checked) {\n          array.push(item);\n        } else {\n          array = array.filter(function (i) {\n            return i !== item;\n          });\n        }\n\n        setFiltersValues(_objectSpread(_objectSpread({}, filtersValues), {}, _defineProperty({}, filterModal.key, array)));\n      }\n    }, item);\n  })), __jsx(Flex, {\n    mainAxis: \"flex-end\",\n    subAxis: \"center\",\n    subSize: \"middle\"\n  }, __jsx(Button, {\n    onClick: function onClick() {\n      delete filters[filterModal.key];\n      setFilters(filters);\n      setFilterModal(false);\n      resetTable();\n    }\n  }, \"\\u53D6\\u6D88\\u7B5B\\u9009\"), __jsx(Button, {\n    onClick: function onClick() {\n      filters[filterModal.key] = filterModal.filter.onFilter;\n      setFilters(filters);\n      setFilterModal(false);\n      resetTable();\n    }\n  }, \"\\u4F7F\\u7528\\u7B5B\\u9009\"))))));\n}","map":null,"metadata":{},"sourceType":"module"}