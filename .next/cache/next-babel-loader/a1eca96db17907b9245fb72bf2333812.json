{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport Input, { InputNumber } from '../';\nimport Popover from '@/components/popover';\nimport Card from '@/components/card';\nimport { Flex } from '@/components/container';\nimport Button from '@/components/button';\nimport { Close, Left } from '@/components/svg';\nimport { concat } from '@/utils/component';\nimport styles from './datepicker.less';\nexport default function DatePicker(props) {\n  var defaultValue = props.defaultValue,\n      value = props.value,\n      onChange = props.onChange,\n      _props$type = props.type,\n      type = _props$type === void 0 ? 'datetime' : _props$type,\n      label = props.label,\n      lablePlacement = props.lablePlacement,\n      placeholder = props.placeholder,\n      restProps = _objectWithoutProperties(props, [\"defaultValue\", \"value\", \"onChange\", \"type\", \"label\", \"lablePlacement\", \"placeholder\"]);\n\n  var defaultDatetime = React.useMemo(function () {\n    return typeof value !== 'undefined' ? new Date(value) : typeof defaultValue !== 'undefined' ? new Date(defaultValue) : new Date();\n  }, []);\n\n  var _React$useState = React.useState({\n    Y: defaultDatetime.getFullYear(),\n    M: defaultDatetime.getMonth() + 1,\n    D: defaultDatetime.getDate()\n  }),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      date = _React$useState2[0],\n      setDate = _React$useState2[1];\n\n  var _React$useState3 = React.useState({\n    H: defaultDatetime.getHours(),\n    M: defaultDatetime.getMinutes(),\n    S: defaultDatetime.getSeconds()\n  }),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      time = _React$useState4[0],\n      setTime = _React$useState4[1];\n\n  var _React$useMemo = React.useMemo(function () {\n    if (typeof value === 'undefined') return {\n      _date: date,\n      _time: time\n    };\n    var datetime = new Date(value);\n    return {\n      _date: {\n        Y: datetime.getFullYear(),\n        M: datetime.getMonth() + 1,\n        D: datetime.getDate()\n      },\n      _time: {\n        H: datetime.getHours(),\n        M: datetime.getMinutes(),\n        S: datetime.getSeconds()\n      }\n    };\n  }, [value, date, time]),\n      _date = _React$useMemo._date,\n      _time = _React$useMemo._time;\n\n  var callback = React.useCallback(function (date, time) {\n    if (!!onChange) {\n      switch (type) {\n        case 'datetime':\n          return onChange(new Date(date.Y, date.M - 1, date.D, time.H, time.M, time.S).getTime());\n\n        case 'date':\n          return onChange(new Date(date.Y, date.M - 1, date.D).getTime());\n\n        case 'time':\n          return onChange(time.H * 3600 + time.M * 60 + time.S);\n      }\n    }\n  }, [onChange]);\n  var dateFormat = React.useMemo(function () {\n    return \"\".concat(_date.Y, \"-\").concat(_date.M.toString().padStart(2, '0'), \"-\").concat(_date.D.toString().padStart(2, '0'));\n  }, [_date]);\n  var timeFormat = React.useMemo(function () {\n    return \"\".concat(_time.H.toString().padStart(2, '0'), \":\").concat(_time.M.toString().padStart(2, '0'), \":\").concat(_time.S.toString().padStart(2, '0'));\n  }, [_time]);\n  var format = React.useMemo(function () {\n    return type === 'datetime' ? \"\".concat(dateFormat, \" \").concat(timeFormat) : type === 'date' ? dateFormat : timeFormat;\n  }, [dateFormat, timeFormat, type]);\n  return __jsx(\"div\", restProps, __jsx(Popover, {\n    card: true,\n    shadow: true,\n    placement: \"bottom\",\n    component: __jsx(Card, null, __jsx(Flex, {\n      direction: \"TB\",\n      wrap: false\n    }, (type === 'datetime' || type === 'date') && __jsx(DatePart, {\n      date: _date,\n      onChange: function onChange(d) {\n        callback(d, _time);\n        setDate(d);\n      }\n    }), (type === 'datetime' || type === 'time') && __jsx(TimePart, {\n      time: _time,\n      onChange: function onChange(t) {\n        callback(_date, t);\n        setTime(t);\n      }\n    })))\n  }, __jsx(Input, {\n    label: label,\n    lablePlacement: lablePlacement,\n    placeholder: placeholder,\n    editable: false,\n    value: format\n  })));\n}\n\nfunction DatePart(props) {\n  var date = props.date,\n      _props$onChange = props.onChange,\n      _onChange = _props$onChange === void 0 ? function () {} : _props$onChange;\n\n  var _React$useState5 = React.useState(false),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      selectYear = _React$useState6[0],\n      setSelectYear = _React$useState6[1];\n\n  var _React$useState7 = React.useState(false),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      selectMonth = _React$useState8[0],\n      setSelectMonth = _React$useState8[1];\n\n  var _React$useState9 = React.useState(date),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      state = _React$useState10[0],\n      setState = _React$useState10[1];\n\n  React.useEffect(function () {\n    return setState(date);\n  }, [date]);\n  return selectYear ? __jsx(Flex, {\n    direction: \"TB\",\n    mainSize: \"small\",\n    subAxis: \"flex-end\"\n  }, __jsx(Close, {\n    onClick: function onClick() {\n      return setSelectYear(false);\n    }\n  }), __jsx(YearSelect, {\n    year: state.Y,\n    onSelect: function onSelect(y) {\n      setSelectYear(false);\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        Y: y\n      }));\n    }\n  })) : selectMonth ? __jsx(Flex, {\n    direction: \"TB\",\n    mainSize: \"small\",\n    subAxis: \"flex-end\"\n  }, __jsx(Close, {\n    onClick: function onClick() {\n      return setSelectMonth(false);\n    }\n  }), __jsx(MonthSelect, {\n    month: state.M,\n    onSelect: function onSelect(m) {\n      setSelectMonth(false);\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        M: m\n      }));\n    }\n  })) : __jsx(Flex, {\n    direction: \"TB\",\n    mainSize: \"small\"\n  }, __jsx(Flex, {\n    mainAxis: \"space-around\"\n  }, __jsx(Button, {\n    icon: __jsx(Left, null),\n    onClick: function onClick() {\n      return setState(_objectSpread(_objectSpread({}, state), {}, {\n        Y: state.Y - 1\n      }));\n    }\n  }), __jsx(Button, {\n    onClick: function onClick() {\n      return setSelectYear(true);\n    }\n  }, state.Y), __jsx(Button, {\n    icon: __jsx(Left, {\n      style: {\n        transform: 'rotate(180deg)'\n      }\n    }),\n    onClick: function onClick() {\n      return setState(_objectSpread(_objectSpread({}, state), {}, {\n        Y: state.Y + 1\n      }));\n    }\n  })), __jsx(Flex, {\n    mainAxis: \"space-around\"\n  }, __jsx(Button, {\n    icon: __jsx(Left, null),\n    onClick: function onClick() {\n      return setState(_objectSpread(_objectSpread({}, state), {}, {\n        M: state.M - 1 === 0 ? 12 : state.M - 1,\n        Y: state.M - 1 === 0 ? state.Y - 1 : state.Y\n      }));\n    }\n  }), __jsx(Button, {\n    onClick: function onClick() {\n      return setSelectMonth(true);\n    }\n  }, state.M, \"\\u6708\"), __jsx(Button, {\n    icon: __jsx(Left, {\n      style: {\n        transform: 'rotate(180deg)'\n      }\n    }),\n    onClick: function onClick() {\n      return setState(_objectSpread(_objectSpread({}, state), {}, {\n        M: state.M + 1 === 13 ? 1 : state.M + 1,\n        Y: state.M + 1 === 13 ? state.Y + 1 : state.Y\n      }));\n    }\n  })), __jsx(DateSelect, {\n    year: state.Y,\n    month: state.M,\n    date: date,\n    onChange: function onChange(date) {\n      return _onChange(date);\n    }\n  }));\n}\n\nvar yRange = 25;\nvar yRangeHalf = 12;\n\nfunction YearSelect(props) {\n  var year = props.year,\n      onSelect = props.onSelect;\n\n  var _React$useState11 = React.useState(year),\n      _React$useState12 = _slicedToArray(_React$useState11, 2),\n      y = _React$useState12[0],\n      setY = _React$useState12[1];\n\n  return __jsx(\"div\", {\n    className: styles.yearSelect\n  }, __jsx(Flex, {\n    mainAxis: \"space-around\"\n  }, __jsx(Button, {\n    icon: __jsx(Left, null),\n    onClick: function onClick() {\n      return setY(y - yRange);\n    }\n  }), year, __jsx(Button, {\n    icon: __jsx(Left, {\n      style: {\n        transform: 'rotate(180deg)'\n      }\n    }),\n    onClick: function onClick() {\n      return setY(y + yRange);\n    }\n  })), __jsx(\"div\", {\n    className: styles.body\n  }, Array(yRange).fill(0).map(function (_, idx) {\n    return __jsx(\"div\", {\n      key: idx,\n      className: idx + y - yRangeHalf === year ? styles.active : '',\n      onClick: function onClick() {\n        return onSelect(idx + y - yRangeHalf);\n      }\n    }, idx + y - yRangeHalf);\n  })));\n}\n\nvar M12 = Array(12).fill(0).map(function (_, i) {\n  return i;\n});\n\nfunction MonthSelect(props) {\n  var month = props.month,\n      onSelect = props.onSelect;\n  return __jsx(\"div\", {\n    className: styles.monthSelect\n  }, M12.map(function (i) {\n    return __jsx(\"div\", {\n      key: i,\n      className: i + 1 === month ? styles.active : '',\n      onClick: function onClick() {\n        return onSelect(i + 1);\n      }\n    }, \"\".concat(i + 1, \"\\u6708\"));\n  }));\n}\n\nvar D7 = ['日', '一', '二', '三', '四', '五', '六'];\n\nfunction DateSelect(props) {\n  var year = props.year,\n      month = props.month,\n      date = props.date,\n      _props$onChange2 = props.onChange,\n      onChange = _props$onChange2 === void 0 ? function () {} : _props$onChange2;\n  var now = new Date();\n  var today = React.useMemo(function () {\n    return new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  }, [now]);\n  var activeDate = React.useMemo(function () {\n    return date.Y === year && date.M === month ? date.D : -1;\n  }, [date, year, month]);\n  var todayDate = React.useMemo(function () {\n    return today.getFullYear() === year && today.getMonth() + 1 == month ? today.getDate() : -1;\n  }, [today, year, month]);\n\n  var _React$useMemo2 = React.useMemo(function () {\n    var weekDay = new Date(year, month - 1, 1).getDay();\n    var maxDay = new Date(year, month, 0).getDate();\n    var afterDay = 7 - (weekDay + maxDay) % 7;\n    var calendar = Array(weekDay + maxDay + afterDay).fill(0);\n\n    for (var i = 0; i < weekDay; i++) {\n      calendar[i] = new Date(year, month - 1, i - weekDay + 1).getDate();\n    }\n\n    for (var i = 1; i <= maxDay; i++) {\n      calendar[i + weekDay - 1] = i;\n    }\n\n    for (var i = 0; i < afterDay; i++) {\n      calendar[maxDay + weekDay + i] = i + 1;\n    }\n\n    return {\n      calendar: calendar,\n      weekDay: weekDay,\n      maxDay: maxDay\n    };\n  }, [date, year, month]),\n      calendar = _React$useMemo2.calendar,\n      weekDay = _React$useMemo2.weekDay,\n      maxDay = _React$useMemo2.maxDay;\n\n  return __jsx(Flex, {\n    direction: \"TB\",\n    subAxis: \"flex-end\",\n    mainSize: \"small\",\n    className: styles.date_select\n  }, __jsx(\"div\", {\n    className: styles.body\n  }, D7.map(function (i) {\n    return __jsx(\"strong\", {\n      key: i\n    }, i);\n  }), calendar.map(function (i, idx) {\n    return __jsx(\"div\", {\n      key: idx,\n      className: concat(idx < weekDay || idx >= weekDay + maxDay ? styles.disabled : i === activeDate ? styles.active : i === todayDate ? styles.today : ''),\n      onClick: function onClick() {\n        return onChange({\n          Y: year,\n          M: month,\n          D: i\n        });\n      }\n    }, i);\n  })), __jsx(Button, {\n    size: \"small\",\n    onClick: function onClick() {\n      return onChange({\n        Y: today.getFullYear(),\n        M: today.getMonth() + 1,\n        D: today.getDate()\n      });\n    }\n  }, \"\\u4ECA\\u5929\"));\n}\n\nfunction TimePart(props) {\n  var time = props.time,\n      onChange = props.onChange;\n\n  var _React$useState13 = React.useState(time),\n      _React$useState14 = _slicedToArray(_React$useState13, 2),\n      state = _React$useState14[0],\n      setState = _React$useState14[1];\n\n  return __jsx(Flex, {\n    direction: \"TB\"\n  }, __jsx(InputNumber, {\n    label: \"\\u65F6\",\n    value: state.H,\n    min: 0,\n    max: 23,\n    onChange: function onChange(v) {\n      return setState(_objectSpread(_objectSpread({}, state), {}, {\n        H: v\n      }));\n    },\n    size: \"small\"\n  }), __jsx(InputNumber, {\n    label: \"\\u5206\",\n    value: state.M,\n    min: 0,\n    max: 59,\n    onChange: function onChange(v) {\n      return setState(_objectSpread(_objectSpread({}, state), {}, {\n        M: v\n      }));\n    },\n    size: \"small\"\n  }), __jsx(InputNumber, {\n    label: \"\\u79D2\",\n    value: state.S,\n    min: 0,\n    max: 59,\n    onChange: function onChange(v) {\n      return setState(_objectSpread(_objectSpread({}, state), {}, {\n        S: v\n      }));\n    },\n    size: \"small\"\n  }), __jsx(Flex, null, __jsx(Button, {\n    onClick: function onClick() {\n      var now = new Date();\n      setState({\n        H: now.getHours(),\n        M: now.getMinutes(),\n        S: now.getSeconds()\n      });\n    },\n    size: \"small\"\n  }, \"\\u5F53\\u524D\\u65F6\\u95F4\"), __jsx(Button, {\n    primary: true,\n    onClick: function onClick() {\n      return onChange(state);\n    },\n    size: \"small\"\n  }, \"\\u786E\\u5B9A\")));\n}","map":null,"metadata":{},"sourceType":"module"}