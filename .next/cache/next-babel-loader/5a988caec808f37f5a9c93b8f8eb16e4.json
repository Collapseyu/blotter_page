{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport Router, { withRouter } from 'next/router';\nimport PostList from '@/components/post_list';\nimport { Pre, Next, Dots } from '@/components/svg';\nimport { A } from '@/components/button';\nimport Timeline from '@/components/timeline';\nimport Card from '@/components/card';\nimport { Flex } from '@/components/container';\nimport { archives } from '@/utils/api';\nimport { parseNumberParams } from '@/utils/parse';\nimport { Context } from '@/utils/global';\nimport { formatSecond } from '@/utils/time';\nimport Pagination from '@/components/pagination';\nimport Tag from '@/components/tag';\nimport textStyles from '@/styles/text.module.scss';\nimport { CheckBox } from '@/components/input';\n\nfunction pageRender(current, pageNumber, size, page, onChange, disabled, extend) {\n  switch (page) {\n    case -2:\n      {\n        return /*#__PURE__*/_jsx(Link, {\n          href: `/archives?card=${extend ? 1 : 0}&page=${current - 1}&size=${size}`,\n          passHref: true,\n          children: /*#__PURE__*/_jsx(A, {\n            disabled: disabled || current - 1 < 1,\n            onClick: () => onChange(current - 1, size),\n            icon: /*#__PURE__*/_jsx(Pre, {})\n          })\n        });\n      }\n\n    case -3:\n      {\n        return /*#__PURE__*/_jsx(Link, {\n          href: `/archives?card=${extend ? 1 : 0}&page=${current + 1}&size=${size}`,\n          passHref: true,\n          children: /*#__PURE__*/_jsx(A, {\n            disabled: disabled || current + 1 > pageNumber,\n            onClick: () => onChange(current + 1, size),\n            icon: /*#__PURE__*/_jsx(Next, {})\n          })\n        });\n      }\n\n    case -1:\n      {\n        return /*#__PURE__*/_jsx(Dots, {});\n      }\n\n    default:\n      {\n        return /*#__PURE__*/_jsx(Link, {\n          href: `/archives?card=${extend ? 1 : 0}&page=${page}&size=${size}`,\n          passHref: true,\n          children: /*#__PURE__*/_jsx(A, {\n            disabled: disabled || current === page,\n            clicked: current === page,\n            onClick: () => onChange(page, size),\n            children: page\n          })\n        });\n      }\n  }\n}\n\nconst timelineSize = 20;\n\nclass Archives extends React.Component {\n  static async getInitialProps(args) {\n    const card = parseNumberParams('card', args.asPath, 0) != 0;\n    const page = parseNumberParams('page', args.asPath, 1);\n    const size = parseNumberParams('size', args.asPath, card ? 10 : timelineSize);\n    const data = await archives(page, size);\n    return {\n      page: page,\n      size: size,\n      posts: data.posts,\n      total: data.total,\n      card: card\n    };\n  }\n\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"context\", void 0);\n\n    _defineProperty(this, \"onChange\", (page, size) => {\n      if (size != this.props.size) {\n        const newPage = Math.floor((this.props.page - 1) * this.props.size / size + 1);\n        Router.push(`/archives?card=${this.props.card ? 1 : 0}&page=${newPage}&size=${size}`);\n      }\n    });\n\n    this.state = {\n      loading: false\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxs(\"div\", {\n      children: [/*#__PURE__*/_jsx(Context.Consumer, {\n        children: context => /*#__PURE__*/_jsx(Head, {\n          children: /*#__PURE__*/_jsx(\"title\", {\n            children: `第${this.props.page}页|归档页|${context.blog_name}`\n          })\n        })\n      }), /*#__PURE__*/_jsxs(Flex, {\n        direction: \"TB\",\n        fullWidth: true,\n        children: [/*#__PURE__*/_jsx(Card, {\n          neumorphism: true,\n          children: /*#__PURE__*/_jsxs(Flex, {\n            direction: \"LR\",\n            mainAxis: \"flex-start\",\n            children: [/*#__PURE__*/_jsx(CheckBox, {\n              switchStyle: true,\n              checkText: \"\\u5361\\u7247\",\n              uncheckText: \"\\u65F6\\u95F4\\u7EBF\",\n              value: this.props.card,\n              onChange: value => Router.push(`/archives?card=${value ? 1 : 0}&page=${this.props.page}&size=${this.props.size}`)\n            }), /*#__PURE__*/_jsxs(\"p\", {\n              children: [\"\\u5171 \", this.props.total, \" \\u7BC7\\u6587\\u7AE0\"]\n            })]\n          })\n        }), this.props.card ? /*#__PURE__*/_jsx(PostList // header={`共 ${this.props.total} 篇文章`}\n        , {\n          posts: this.props.posts,\n          page: this.props.page,\n          size: this.props.size,\n          total: this.props.total,\n          loading: this.state.loading,\n          callback: this.onChange,\n          pageRender: pageRender,\n          pageExtend: this.props.card\n        }) : /*#__PURE__*/_jsx(Card, {\n          neumorphism: true,\n          children: /*#__PURE__*/_jsxs(Flex, {\n            direction: \"TB\",\n            fullWidth: true,\n            children: [/*#__PURE__*/_jsx(Timeline, {\n              direction: \"TB\",\n              data: this.props.posts.map(p => ({\n                time: formatSecond(p.publish_time),\n                name: /*#__PURE__*/_jsxs(Flex, {\n                  direction: this.context.big_screen ? 'LR' : 'TB',\n                  subAxis: \"flex-start\",\n                  fullWidth: !this.context.big_screen,\n                  children: [/*#__PURE__*/_jsx(Link, {\n                    href: \"/post/[url]\",\n                    as: `/post/${p.url}`,\n                    children: /*#__PURE__*/_jsx(\"a\", {\n                      className: textStyles.color,\n                      style: {\n                        fontWeight: 'bolder'\n                      },\n                      children: p.title\n                    })\n                  }), /*#__PURE__*/_jsx(Flex, {\n                    direction: \"LR\",\n                    mainAxis: \"flex-end\",\n                    subSize: \"middle\",\n                    children: p.tags.map(tag => /*#__PURE__*/_jsx(Tag, {\n                      tag: tag\n                    }))\n                  })]\n                })\n              })),\n              style: {\n                gridTemplateColumns: this.context.big_screen ? '150px 25px 1px auto' : '75px 25px 1px auto'\n              }\n            }), /*#__PURE__*/_jsx(Pagination, {\n              page: this.props.page,\n              size: this.props.size,\n              total: this.props.total,\n              disabled: this.state.loading,\n              onChange: this.onChange,\n              render: pageRender,\n              sizeSelect: [10, 20, 30, 40],\n              extend: this.props.card\n            })]\n          })\n        })]\n      })]\n    });\n  }\n\n}\n\n_defineProperty(Archives, \"defaultProps\", {\n  page: 1,\n  total: 1,\n  size: 10,\n  posts: Array(10).fill(undefined)\n});\n\n_defineProperty(Archives, \"contextType\", Context);\n\nexport default withRouter(Archives);","map":null,"metadata":{},"sourceType":"module"}