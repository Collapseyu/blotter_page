{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport Head from 'next/head';\nimport { withRouter } from 'next/router';\nimport CommentPart from '@/components/comment';\nimport { Flex } from '@/components/container';\nimport PostContent from '@/components/post_content';\nimport { Qzone, QQ, Link } from '@/components/svg';\nimport Card from '@/components/card';\nimport Avatar from '@/components/avatar';\nimport Button, { A } from '@/components/button';\nimport Anchor from '@/components/anchor';\nimport Notification from '@/components/notification';\nimport { post, view } from '@/utils/api';\nimport { Context } from '@/utils/global';\nimport moment from 'moment';\nimport './post.module.scss';\n\nclass PostPage extends React.Component {\n  static async getInitialProps(args) {\n    var url = args.query.url;\n\n    if (Array.isArray(url)) {\n      url = url[0];\n    }\n\n    var r = await post(url);\n    return {\n      post: r\n    };\n  }\n\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"context\", void 0);\n\n    _defineProperty(this, \"render_share\", () => {\n      return /*#__PURE__*/_jsx(Context.Consumer, {\n        children: context => {\n          if (typeof document === 'undefined') return null;\n          const url = `${context.root.replace(/\\/$/, '')}/${document.location.pathname.replace(/^\\//, '')}`;\n          return /*#__PURE__*/_jsxs(Flex, {\n            direction: \"TB\",\n            mainAxis: \"flex-start\",\n            fullWidth: true,\n            children: [/*#__PURE__*/_jsxs(Flex, {\n              direction: \"LR\",\n              wrap: false,\n              children: [/*#__PURE__*/_jsx(Flex.Item, {\n                style: {\n                  flex: '0 0 5em',\n                  display: 'flex',\n                  justifyContent: 'center'\n                },\n                children: /*#__PURE__*/_jsx(Avatar, {\n                  src: context.avatar,\n                  style: {\n                    width: '5em',\n                    height: '5em'\n                  }\n                })\n              }), /*#__PURE__*/_jsxs(Flex.Item, {\n                style: {\n                  flex: '1 1 auto'\n                },\n                children: [/*#__PURE__*/_jsx(\"strong\", {\n                  children: context.author\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  children: [\"\\u672C\\u6587\\u7AE0\\u53D1\\u5E03\\u81EA \", /*#__PURE__*/_jsx(\"a\", {\n                    href: context.root,\n                    children: context.blog_name\n                  }), \"\\uFF0C\\u539F\\u6587\\u300E\", /*#__PURE__*/_jsx(\"a\", {\n                    href: url,\n                    children: this.props.post.title\n                  }), \"\\u300F\", /*#__PURE__*/_jsx(\"br\", {}), \"\\u5982\\u65E0\\u7279\\u522B\\u8BF4\\u660E\\uFF0C\\u53EF\\u4EE5\\u76F4\\u63A5\\u8F6C\\u8F7D\\uFF0C\\u4F46\\u8BF7\\u6CE8\\u660E\\u539F\\u6587\\u51FA\\u5904\\u94FE\\u63A5\\uFF1A\", /*#__PURE__*/_jsx(\"a\", {\n                    href: url,\n                    children: url\n                  })]\n                })]\n              })]\n            }), /*#__PURE__*/_jsxs(Flex, {\n              direction: \"LR\",\n              mainAxis: \"space-around\",\n              children: [/*#__PURE__*/_jsx(A, {\n                target: \"_blank\",\n                href: `http://connect.qq.com/widget/shareqq/index.html?url=${encodeURIComponent(url)}&sharesource=qzone&title=${encodeURIComponent(this.props.post.title)}&pics=${this.props.post.head_image}&summary=${this.props.post.abstract}&desc=${this.props.post.abstract}`,\n                icon: /*#__PURE__*/_jsx(QQ, {})\n              }), /*#__PURE__*/_jsx(A, {\n                target: \"_blank\",\n                href: `https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=${encodeURIComponent(url)}&sharesource=qzone&title=${encodeURIComponent(this.props.post.title)}&pics=${this.props.post.head_image}&summary=${this.props.post.abstract}`,\n                icon: /*#__PURE__*/_jsx(Qzone, {})\n              }), /*#__PURE__*/_jsx(Button, {\n                icon: /*#__PURE__*/_jsx(Link, {}),\n                onClick: () => alert(`请复制：${url}`)\n              })]\n            })]\n          });\n        }\n      });\n    });\n\n    this.state = {};\n  }\n\n  componentDidMount() {\n    var url = this.props.router.query.url;\n\n    if (Array.isArray(url)) {\n      url = url[0];\n    }\n\n    view(url);\n  }\n\n  render() {\n    return typeof this.props.post === 'undefined' ? null : /*#__PURE__*/_jsxs(React.Fragment, {\n      children: [/*#__PURE__*/_jsx(Context.Consumer, {\n        children: context => /*#__PURE__*/_jsxs(Head, {\n          children: [/*#__PURE__*/_jsx(\"title\", {\n            children: `${this.props.post.title}|${context.blog_name}`\n          }), /*#__PURE__*/_jsx(\"meta\", {\n            name: \"keywords\",\n            content: Array.isArray(this.props.post.keywords) ? this.props.post.keywords.join(',') : ''\n          }, \"keywords\"), /*#__PURE__*/_jsx(\"meta\", {\n            name: \"description\",\n            content: this.props.post.abstract\n          }, \"description\")]\n        })\n      }), /*#__PURE__*/_jsxs(Flex, {\n        direction: \"TB\",\n        fullWidth: true,\n        style: {\n          maxWidth: this.context.big_screen ? 'calc(100vw - 600px)' : '100%',\n          margin: 'auto'\n        },\n        children: [/*#__PURE__*/_jsx(Card, {\n          neumorphism: true,\n          style: {\n            padding: this.context.big_screen ? 20 : 0\n          },\n          mainStyle: this.context.big_screen ? {} : {\n            padding: 10\n          },\n          children: /*#__PURE__*/_jsx(PostContent, {\n            post: this.props.post,\n            prefix: // 超过 3 个月的文章，给出提示\n            (new Date().getTime() / 1000 - this.props.post.edit_time) / 3600 / 24 > 30 * 3 && /*#__PURE__*/_jsx(Notification, {\n              alertType: \"warning\",\n              title: \"\\u6CE8\\u610F\",\n              content: `这是一篇最后编辑于 ${moment(this.props.post.edit_time, 'X').fromNow()} 的文章，其内容可能与目前实际情况差异较大，请注意甄别`\n            }),\n            suffix: /*#__PURE__*/_jsx(Card, {\n              neumorphismInset: true,\n              children: this.render_share()\n            })\n          })\n        }), /*#__PURE__*/_jsx(Card, {\n          neumorphism: true,\n          children: /*#__PURE__*/_jsx(CommentPart, {\n            url: `/post/${this.props.router.query.url}`\n          })\n        })]\n      }), /*#__PURE__*/_jsx(Anchor, {\n        style: {\n          position: 'fixed'\n        },\n        content: this.props.post.content,\n        suffixAnchors: [{\n          name: '评论区',\n          id: 'blotter-comment',\n          level: 1\n        }]\n      })]\n    });\n  }\n\n}\n\n_defineProperty(PostPage, \"contextType\", Context);\n\n_defineProperty(PostPage, \"defaultProps\", {\n  anchors: []\n});\n\nexport default withRouter(PostPage);","map":null,"metadata":{},"sourceType":"module"}