{"ast":null,"code":"import _objectDestructuringEmpty from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/objectDestructuringEmpty\";\nimport _slicedToArray from \"/github/workspace/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React from 'react';\nimport { useDrag, useDrop } from 'react-dnd';\nimport Button from '@/components/button';\nimport { Plus, Close } from '@/components/svg';\nimport Input, { InputNumber, CheckBox, TextArea } from '@/components/input';\nimport { Flex } from '@/components/container';\nimport Popover from '@/components/popover';\nimport randomString from '@/utils/random';\nimport { waitUntil } from '@/utils/debounce';\nimport hash from '@/utils/hash';\nimport styles from './dynamic.module.scss';\nvar stringLength = 20;\n\nvar DragItem = function DragItem(props) {\n  var ref = React.useRef();\n\n  var _useDrop = useDrop({\n    accept: props.id,\n    drop: function drop(item) {\n      props.swap(item['index'], props.index);\n      return item;\n    }\n  }),\n      _useDrop2 = _slicedToArray(_useDrop, 2);\n\n  _objectDestructuringEmpty(_useDrop2[0]);\n\n  var drop = _useDrop2[1];\n\n  var _useDrag = useDrag({\n    item: {\n      type: props.id,\n      index: props.index\n    }\n  }),\n      _useDrag2 = _slicedToArray(_useDrag, 2);\n\n  _objectDestructuringEmpty(_useDrag2[0]);\n\n  var drag = _useDrag2[1];\n  drop(drag(ref));\n  return /*#__PURE__*/_jsx(\"div\", {\n    ref: ref,\n    children: props.children\n  });\n};\n\nvar Menu = function Menu(callback) {\n  return /*#__PURE__*/_jsxs(\"ul\", {\n    className: styles.menus,\n    children: [/*#__PURE__*/_jsx(\"li\", {\n      onClick: function onClick() {\n        return callback(randomString());\n      },\n      children: \"\\u6587\\u672C\\u6846\"\n    }), /*#__PURE__*/_jsx(\"li\", {\n      onClick: function onClick() {\n        return callback(randomString(stringLength));\n      },\n      children: \"\\u591A\\u884C\\u6587\\u672C\\u6846\"\n    }), /*#__PURE__*/_jsx(\"li\", {\n      onClick: function onClick() {\n        return callback(false);\n      },\n      children: \"\\u591A\\u9009\\u6846\"\n    }), /*#__PURE__*/_jsx(\"li\", {\n      onClick: function onClick() {\n        return callback(0);\n      },\n      children: \"\\u6570\\u5B57\\u6846\"\n    }), /*#__PURE__*/_jsx(\"li\", {\n      onClick: function onClick() {\n        return callback([]);\n      },\n      children: \"\\u5217\\u8868\"\n    }), /*#__PURE__*/_jsx(\"li\", {\n      onClick: function onClick() {\n        return callback({});\n      },\n      children: \"\\u5BF9\\u8C61\"\n    })]\n  });\n};\n\nvar InputField = function InputField(props) {\n  var id = randomString();\n  return /*#__PURE__*/_jsx(Input, {\n    defaultValue: props.value,\n    onChange: function onChange(value) {\n      waitUntil(id, function () {\n        return props.callback(value);\n      }, 1000);\n    },\n    style: {\n      width: '100%'\n    }\n  });\n};\n\nvar CheckField = function CheckField(props) {\n  var id = randomString();\n  return /*#__PURE__*/_jsx(CheckBox, {\n    value: props.value,\n    onChange: function onChange(value) {\n      waitUntil(id, function () {\n        return props.callback(value);\n      }, 1000);\n    }\n  });\n};\n\nvar AreaField = function AreaField(props) {\n  var id = randomString();\n  return /*#__PURE__*/_jsx(TextArea, {\n    defaultValue: props.value,\n    onChange: function onChange(value) {\n      waitUntil(id, function () {\n        return props.callback(value);\n      }, 1000);\n    }\n  });\n};\n\nvar NumberField = function NumberField(props) {\n  var id = randomString();\n  return /*#__PURE__*/_jsx(InputNumber, {\n    defaultValue: props.value,\n    onChange: function onChange(value) {\n      waitUntil(id, function () {\n        return props.callback(value);\n      }, 1000);\n    }\n  });\n};\n\nvar ArrayField = function ArrayField(props) {\n  var id = randomString();\n  return /*#__PURE__*/_jsxs(Flex, {\n    fullWidth: true,\n    direction: \"TB\",\n    subAxis: \"flex-end\",\n    children: [/*#__PURE__*/_jsx(Flex, {\n      fullWidth: true,\n      direction: \"TB\",\n      children: props.value.map(function (item, idx) {\n        return /*#__PURE__*/_jsx(DragItem, {\n          id: id,\n          index: idx,\n          swap: function swap(i, j) {\n            var v = props.value;\n            var temp = v[i];\n            v[i] = v[j];\n            v[j] = temp;\n            props.callback(v);\n          },\n          children: /*#__PURE__*/_jsxs(Flex, {\n            children: [/*#__PURE__*/_jsx(Flex.Item, {\n              style: {\n                flex: '1 1 auto'\n              },\n              children: /*#__PURE__*/_jsx(DynamicForm, {\n                value: item,\n                callback: function callback(value) {\n                  var v = props.value;\n                  v[idx] = value;\n                  props.callback(v);\n                }\n              }, hash(item))\n            }), /*#__PURE__*/_jsx(Flex.Item, {\n              style: {\n                flex: '0 0 auto'\n              },\n              children: /*#__PURE__*/_jsx(Button, {\n                danger: true,\n                neumorphism: true,\n                circle: true,\n                icon: /*#__PURE__*/_jsx(Close, {}),\n                onClick: function onClick() {\n                  var v = props.value.filter(function (_, i) {\n                    return i !== idx;\n                  });\n                  props.callback(v);\n                }\n              })\n            })]\n          })\n        }, hash(item));\n      })\n    }), /*#__PURE__*/_jsx(Flex.Item, {\n      style: {\n        width: 'unset'\n      },\n      children: /*#__PURE__*/_jsx(Popover, {\n        card: true,\n        shadow: true,\n        component: Menu(function (newValue) {\n          var v = props.value;\n          v.push(newValue);\n          props.callback(v);\n        }),\n        children: /*#__PURE__*/_jsx(Button, {\n          neumorphism: true,\n          prefix: /*#__PURE__*/_jsx(Plus, {}),\n          children: \"\\u65B0\\u5EFA\\u4E00\\u9879\\u5143\\u7D20\"\n        })\n      })\n    })]\n  });\n};\n\nvar ObjectField = function ObjectField(props) {\n  var id = randomString();\n  var slice = Object.keys(props.value).map(function (key) {\n    return {\n      key: key,\n      value: props.value[key]\n    };\n  });\n  return /*#__PURE__*/_jsxs(Flex, {\n    fullWidth: true,\n    direction: \"TB\",\n    subAxis: \"flex-end\",\n    children: [/*#__PURE__*/_jsx(Flex, {\n      fullWidth: true,\n      direction: \"TB\",\n      children: slice.map(function (item) {\n        return /*#__PURE__*/_jsxs(Flex, {\n          subAxis: \"flex-start\",\n          children: [/*#__PURE__*/_jsx(Flex.Item, {\n            style: {\n              flex: '0 0 30%'\n            },\n            children: /*#__PURE__*/_jsx(DynamicForm, {\n              value: item.key,\n              callback: function callback(value) {\n                var obj = {};\n\n                for (var key in props.value) {\n                  if (key == item.key) {\n                    obj[value] = props.value[key];\n                  } else {\n                    obj[key] = props.value[key];\n                  }\n                }\n\n                props.callback(obj);\n              }\n            })\n          }), /*#__PURE__*/_jsx(Flex.Item, {\n            style: {\n              flex: '1 1 auto'\n            },\n            children: /*#__PURE__*/_jsx(DynamicForm, {\n              value: item.value,\n              callback: function callback(value) {\n                var v = props.value;\n                v[item.key] = value;\n                props.callback(v);\n              }\n            })\n          }), /*#__PURE__*/_jsx(Flex.Item, {\n            style: {\n              flex: '0 0 auto'\n            },\n            children: /*#__PURE__*/_jsx(Button, {\n              neumorphism: true,\n              danger: true,\n              circle: true,\n              icon: /*#__PURE__*/_jsx(Close, {}),\n              onClick: function onClick() {\n                var v = props.value;\n                delete v[item.key];\n                props.callback(v);\n              }\n            })\n          })]\n        }, hash(item));\n      })\n    }), /*#__PURE__*/_jsx(Flex.Item, {\n      style: {\n        width: 'unset'\n      },\n      children: /*#__PURE__*/_jsx(Popover, {\n        card: true,\n        shadow: true,\n        component: Menu(function (newValue) {\n          var v = props.value;\n          v[randomString()] = newValue;\n          props.callback(v);\n        }),\n        children: /*#__PURE__*/_jsx(Button, {\n          neumorphism: true,\n          prefix: /*#__PURE__*/_jsx(Plus, {}),\n          children: \"\\u65B0\\u5EFA\\u4E00\\u6761\\u5C5E\\u6027\"\n        })\n      })\n    })]\n  });\n};\n\nvar DynamicForm = function DynamicForm(props) {\n  var child = /*#__PURE__*/_jsx(InputField, {\n    value: props.value,\n    callback: props.callback\n  });\n\n  switch (typeof props.value) {\n    case 'string':\n      if (props.value.length > stringLength) {\n        child = /*#__PURE__*/_jsx(AreaField, {\n          value: props.value,\n          callback: props.callback\n        });\n      } else {\n        child = /*#__PURE__*/_jsx(InputField, {\n          value: props.value,\n          callback: props.callback\n        });\n      }\n\n      break;\n\n    case 'number':\n      child = /*#__PURE__*/_jsx(NumberField, {\n        value: props.value,\n        callback: props.callback\n      });\n      break;\n\n    case 'object':\n      if (Array.isArray(props.value)) {\n        child = /*#__PURE__*/_jsx(ArrayField, {\n          value: props.value,\n          callback: props.callback\n        });\n      } else {\n        child = /*#__PURE__*/_jsx(ObjectField, {\n          value: props.value,\n          callback: props.callback\n        });\n      }\n\n      break;\n\n    case 'boolean':\n      child = /*#__PURE__*/_jsx(CheckField, {\n        value: props.value,\n        callback: props.callback\n      });\n      break;\n  }\n\n  return child;\n};\n\nexport default DynamicForm;","map":null,"metadata":{},"sourceType":"module"}